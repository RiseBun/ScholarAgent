# ä¿®å¤ScholarAgentçš„æ ¸å¿ƒé—®é¢˜

## ç›®æ ‡
è§£å†³ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š
1. Streamlitå´©æºƒ (DuplicateElementKey)
2. OpenAlex API 400é”™è¯¯
3. æœç´¢ç»“æœåƒç¯‡ä¸€å¾‹ï¼Œç¼ºä¹å¤šæ ·æ€§

## å…·ä½“ä¿®å¤æ­¥éª¤

### 1. ä¿®å¤Streamlitå´©æºƒé—®é¢˜ (DuplicateElementKey)
- **é—®é¢˜åŸå› **ï¼šç”Ÿæˆ"â­ Save"æŒ‰é’®æ—¶keyé‡å¤
- **è§£å†³æ–¹æ¡ˆ**ï¼šæ”¹è¿›keyç”Ÿæˆé€»è¾‘ï¼Œä½¿ç”¨ç´¢å¼•ç¡®ä¿å”¯ä¸€æ€§
- **ä¿®æ”¹ä½ç½®**ï¼š`pages/1_ğŸ”_Search.py` ä¸­çš„è®ºæ–‡å±•ç¤ºå¾ªç¯
- **å…·ä½“ä¿®æ”¹**ï¼š
  - ä½¿ç”¨ `enumerate()` ä¸ºæ¯ä¸ªè®ºæ–‡æ·»åŠ ç´¢å¼•
  - ç”Ÿæˆæ›´å”¯ä¸€çš„keyï¼š`f"bookmark_{idx}_{st.session_state.search_count}"`
  - ç¡®ä¿å³ä½¿æœ‰é‡å¤è®ºæ–‡ï¼Œkeyä¹Ÿä¸ä¼šé‡å¤

### 2. ä¿®å¤OpenAlex API 400é”™è¯¯
- **é—®é¢˜åŸå› **ï¼šOpenAlex APIä¸æ”¯æŒç›´æ¥ä½¿ç”¨`venue`å­—æ®µè¿›è¡Œè¿‡æ»¤
- **è§£å†³æ–¹æ¡ˆ**ï¼šç§»é™¤URLä¸­çš„venueè¿‡æ»¤ï¼Œæ”¹ä¸ºåœ¨Pythonç«¯è¿›è¡Œè½¯è¿‡æ»¤
- **ä¿®æ”¹ä½ç½®**ï¼š`backend/search_engine.py` ä¸­çš„OpenAlex APIè°ƒç”¨
- **å…·ä½“ä¿®æ”¹**ï¼š
  - ç§»é™¤ `filters.append(f"venue:{venue_filter}")` ä»£ç 
  - å¢åŠ è¿”å›ç»“æœæ•°é‡ï¼Œä¸€æ¬¡è·å–æ›´å¤šè®ºæ–‡
  - åœ¨Pythonç«¯å®ç°è½¯è¿‡æ»¤ï¼šæ¨¡ç³ŠåŒ¹é…venueåç§°

### 3. æå‡æœç´¢ç»“æœå¤šæ ·æ€§
- **é—®é¢˜åŸå› **ï¼šå½“å‰æœç´¢é€»è¾‘åªè¿”å›APIé»˜è®¤æ’åºçš„ç»“æœï¼Œç¼ºä¹å¤šæ ·æ€§
- **è§£å†³æ–¹æ¡ˆ**ï¼šå®ç°MMR (æœ€å¤§è¾¹é™…ç›¸å…³æ€§)ç®—æ³•è¿›è¡Œç»“æœé‡æ’åº
- **ä¿®æ”¹ä½ç½®**ï¼š
  - åœ¨ `pages/1_ğŸ”_Search.py` ä¸­æ·»åŠ å¤šæ ·æ€§å¤„ç†å‡½æ•°
  - ä¿®æ”¹æœç´¢æµç¨‹ï¼Œåœ¨æ˜¾ç¤ºç»“æœå‰è¿›è¡Œé‡æ’åº
- **å…·ä½“ä¿®æ”¹**ï¼š
  - æ·»åŠ  `diversify_papers()` å‡½æ•°ï¼Œä½¿ç”¨TF-IDFå’Œä½™å¼¦ç›¸ä¼¼åº¦
  - å¢åŠ APIè°ƒç”¨çš„ç»“æœæ•°é‡ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„å€™é€‰è®ºæ–‡
  - åœ¨æ˜¾ç¤ºå‰å¯¹è®ºæ–‡åˆ—è¡¨è¿›è¡Œé‡æ’åºï¼Œç¡®ä¿è¦†ç›–ä¸åŒå­ä¸»é¢˜

## æŠ€æœ¯å®ç°ç»†èŠ‚

### Streamlitå´©æºƒä¿®å¤
```python
# ä¿®æ”¹å‰
for paper in all_papers:
    paper_id = paper.title
    bookmark_key = f"bookmark_{paper_id}_{st.session_state.search_count}"
    if st.button(f"â­ Save", key=bookmark_key):
        # ä¿å­˜é€»è¾‘

# ä¿®æ”¹å
for idx, paper in enumerate(all_papers):
    paper_id = paper.title
    bookmark_key = f"bookmark_{idx}_{st.session_state.search_count}"
    if st.button(f"â­ Save", key=bookmark_key):
        # ä¿å­˜é€»è¾‘
```

### OpenAlex APIä¿®å¤
```python
# ä¿®æ”¹å‰
if venue_filter:
    filters.append(f"venue:{venue_filter}")

# ä¿®æ”¹å
# ç§»é™¤venueè¿‡æ»¤ï¼Œæ”¹ä¸ºåœ¨Pythonç«¯å¤„ç†

# åœ¨ç»“æœå¤„ç†éƒ¨åˆ†æ·»åŠ è½¯è¿‡æ»¤
filtered_papers = []
for paper in papers:
    venue_name = paper.get('venue', '').lower()
    if not venue_filter or venue_filter.lower() in venue_name:
        filtered_papers.append(paper)
papers = filtered_papers
```

### æœç´¢ç»“æœå¤šæ ·æ€§æå‡
```python
# æ·»åŠ å¤šæ ·æ€§å¤„ç†å‡½æ•°
def diversify_papers(papers, top_n=20):
    from sklearn.feature_extraction.text import TfidfVectorizer
    from sklearn.metrics.pairwise import cosine_similarity
    import numpy as np
    
    if len(papers) < top_n:
        return papers
    
    # æå–æ‘˜è¦
    abstracts = [paper.get('abstract', '') or paper.get('title', '') for paper in papers]
    
    # å‘é‡åŒ–
    tfidf = TfidfVectorizer(stop_words='english').fit_transform(abstracts)
    cosine_sim = cosine_similarity(tfidf)
    
    # MMRç®—æ³•é€‰æ‹©å¤šæ ·æ€§ç»“æœ
    selected_indices = [0]  # æ€»æ˜¯é€‰æ‹©ç›¸å…³æ€§æœ€é«˜çš„
    candidate_indices = list(range(1, len(papers)))
    
    while len(selected_indices) < top_n and candidate_indices:
        # è®¡ç®—æ¯ä¸ªå€™é€‰ä¸å·²é€‰è®ºæ–‡çš„æœ€å¤§ç›¸ä¼¼åº¦
        similarities_to_selected = cosine_sim[candidate_indices][:, selected_indices]
        max_similarity_per_candidate = np.max(similarities_to_selected, axis=1)
        
        # é€‰æ‹©ç›¸ä¼¼åº¦æœ€å°çš„ï¼ˆæœ€ç‹¬ç‰¹çš„ï¼‰
        best_candidate_idx = np.argmin(max_similarity_per_candidate)
        original_idx = candidate_indices[best_candidate_idx]
        
        selected_indices.append(original_idx)
        candidate_indices.pop(best_candidate_idx)
        
    return [papers[i] for i in selected_indices]

# åœ¨æœç´¢æµç¨‹ä¸­ä½¿ç”¨
papers = fetcher.search_papers(...)
diversified_papers = diversify_papers(papers)
```

## é¢„æœŸæ•ˆæœ
- **Streamlitä¸å†å´©æºƒ**ï¼šæŒ‰é’®keyå”¯ä¸€ï¼Œå³ä½¿æœ‰é‡å¤è®ºæ–‡ä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤º
- **OpenAlex APIè°ƒç”¨æˆåŠŸ**ï¼šç§»é™¤ä¸æ”¯æŒçš„venueè¿‡æ»¤å‚æ•°
- **æœç´¢ç»“æœæ›´åŠ å¤šæ ·**ï¼šé€šè¿‡MMRç®—æ³•é‡æ’åºï¼Œè¦†ç›–ä¸åŒå­ä¸»é¢˜
- **ç”¨æˆ·ä½“éªŒæå‡**ï¼šè·å¾—æ›´å…¨é¢ã€æ›´æ™ºèƒ½çš„è®ºæ–‡æ¨è

## å®æ–½é¡ºåº
1. å…ˆä¿®å¤Streamlitå´©æºƒé—®é¢˜ï¼ˆç´§æ€¥ï¼‰
2. å†ä¿®å¤OpenAlex APIé”™è¯¯ï¼ˆé‡è¦ï¼‰
3. æœ€åæå‡æœç´¢ç»“æœå¤šæ ·æ€§ï¼ˆæå‡ç”¨æˆ·ä½“éªŒï¼‰